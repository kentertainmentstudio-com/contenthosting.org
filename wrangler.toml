# ContentHosting.org - Wrangler Configuration
# 
# This file configures Cloudflare Pages, D1 database, and Workers.
# Update the D1 database ID and KV namespace ID before deploying.

name = "contenthosting"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

# Pages configuration
pages_build_output_dir = "public"

# ============================================
# D1 Database Binding (File Metadata Storage)
# ============================================
# Create the database first:
#   wrangler d1 create contenthosting-db
#
# Then update the database_id below with your actual ID
# Run schema: wrangler d1 execute contenthosting-db --file=schema.sql

[[d1_databases]]
binding = "DB"
database_name = "contenthosting-db"
database_id = "568810b9-98a9-4647-9ffa-2be769660696"

# ============================================
# KV Namespace Binding (Sessions Only)
# ============================================
# For local development, use a local ID like "local-kv"
# For production, replace with your actual Cloudflare KV namespace ID

[[kv_namespaces]]
binding = "CONTENT_KV"
id = "0f50e6ce307a4beb89d396c7e327c988"

# ============================================
# Environment Variables (Non-Secret)
# ============================================
# Set these in Cloudflare Dashboard for production
# These are example values - update for your setup

[vars]
B2_BUCKET = "xpandorax"
B2_REGION = "us-east-005"
B2_ENDPOINT = "s3.us-east-005.backblazeb2.com"
# Public URL for B2 bucket (for media delivery)
# Format: https://f00X.backblazeb2.com/file/bucket-name
# Or use custom subdomain: https://media.contenthosting.org/file/bucket-name
B2_PUBLIC_URL = "https://f004.backblazeb2.com/file/xpandorax"

# ============================================
# Secrets (NEVER put real values here)
# ============================================
# Set these via Cloudflare Dashboard → Settings → Environment variables
# Or use: wrangler secret put <SECRET_NAME>
#
# Required secrets:
#   - ADMIN_PASSWORD_HASH  (SHA-256 hash of admin password)
#   - B2_KEY_ID            (Backblaze B2 key ID)
#   - B2_APP_KEY           (Backblaze B2 application key)
#
# Example commands:
#   wrangler secret put ADMIN_PASSWORD_HASH
#   wrangler secret put B2_KEY_ID
#   wrangler secret put B2_APP_KEY

# ============================================
# Local Development
# ============================================
# For local dev, create .dev.vars file with:
#
# ADMIN_PASSWORD_HASH=your_sha256_hash
# B2_KEY_ID=your_key_id
# B2_APP_KEY=your_app_key
# B2_BUCKET=contenthosting-media
# B2_REGION=us-west-004
# B2_ENDPOINT=s3.us-west-004.backblazeb2.com
# B2_PUBLIC_URL=https://f004.backblazeb2.com/file/contenthosting-media

